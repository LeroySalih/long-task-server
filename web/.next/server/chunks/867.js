exports.id=867,exports.ids=[867],exports.modules={1693:(e,s,t)=>{Promise.resolve().then(t.bind(t,6136)),Promise.resolve().then(t.t.bind(t,79404,23))},52372:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},30228:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,79404,23))},35303:()=>{},6136:(e,s,t)=>{"use strict";t.d(s,{default:()=>n});var a=t(10326),l=t(17577);let n=()=>{let[e,s]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let e=new EventSource("/api/sse");return e.onmessage=e=>{let t=JSON.parse(e.data);s(e=>[t,...e])},e.onerror=s=>{console.error("EventSource failed:",s),e.close()},()=>{e.close()}},[]),(0,a.jsxs)("div",{children:[a.jsx("h1",{children:"Server-Sent Events"}),a.jsx("ul",{children:e&&e.length>0&&e[0].message})]})}},35954:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g,metadata:()=>x});var a=t(19510),l=t(85384),n=t.n(l);t(67272);var r=t(57371);let i=()=>{let e=[{label:"Home",url:"/"},{label:"Update",url:"/update"},{label:"P&M",url:"/planning-marking"}];return a.jsx(a.Fragment,{children:e&&e.map((e,s)=>a.jsx(r.default,{className:"p-3 rounded-md ",href:e.url,children:a.jsx("div",{children:e.label})},s))})};var d=t(68570);let c=(0,d.createProxy)(String.raw`/Users/leroysalih/Long-task-svr/web/components/log-listener/index.tsx`),{__esModule:o,$$typeof:m}=c;c.default;let u=(0,d.createProxy)(String.raw`/Users/leroysalih/Long-task-svr/web/components/log-listener/index.tsx#default`);console.log("Database HOST",process.env.POSTGRES_HOST),console.log("Message HOST",process.env.RABBITMQ_DEFAULT_HOST);let x={title:"CAT Dept",description:"Created by Leroy Salih"};function g({children:e}){return a.jsx("html",{lang:"en",children:(0,a.jsxs)("body",{className:`${n().className} text-grey-600 bg-slate-100`,children:[a.jsx("div",{className:"min-h-[100px] text-skin-inverted text-4xl flex items-center pl-5 bg-slate-700 text-white font-roboto-condensed ",children:"Commerce and Technology Dept"}),(0,a.jsxs)("div",{className:"flex flex-col place-content-center w-100 grid-cols-1 gap-4 md:grid md:grid-cols-12",children:[(0,a.jsxs)("div",{className:"min-h-[100px] rounded-lg bg-slate-300 shadow  m-2 p-4 md:block md:col-span-2 ",children:[a.jsx(i,{}),a.jsx(u,{})]}),a.jsx("div",{className:"min-h-[100px] rounded-lg bg-white shadow text-slate-700 m-2  md:col-span-10 truncate ",children:a.jsx("div",{className:"m-4 p-4",children:e})})]})]})})}},64616:(e,s,t)=>{"use strict";t.d(s,{Z:()=>d});var a=t(71603),l=t(61519);let n=e=>{let s=a.ou.fromISO(e);return(0,l.YL)(s)},r=e=>{let s=a.ou.fromISO(e);return(0,l.XW)(s)},i=e=>{let s=a.ou.fromISO(e);return(0,l.IZ)(s)},d=e=>{if(void 0===e||void 0===e.assignments)return["noClassPlanningData"];let{assignments:s}=e,t=[],a=s.filter(e=>n(e.assignment.due_date_time))||[];0==a.length&&t.push("hasNoAssignmentsInCurrentWeek"),0===((s.filter(e=>r(e.assignment.due_date_time))||[]).length||0)&&t.push("hasNoAssignmentsInNextWeek");let l=!1;if((s.filter(e=>i(e.assignment.due_date_time))||[]).length>0){for(let e of a)if(e.outcomes.filter(e=>null===e.points).length>0){l=!0;break}l&&t.push("hasUnmarkedInPrevWeek")}return t}},52359:(e,s,t)=>{"use strict";t.d(s,{N:()=>c,n:()=>o});var a=t(35900),l=t.n(a),n=t(46812);let{Client:r,Pool:i}=l(),d=new i(n.T),c=async(e,s)=>{let t,a;try{let a=`select class_id, class_display_name, jsonb_agg( json_build_object( 'assignment', assignment, 'outcomes', outcomes )) as assignments
        from (
        select class_id,  class_display_name, 
                json_build_object('assignment_id', assignment_id, 'display_name', display_name, 'due_date_time', due_date_time) as "assignment", 
                json_agg( jsonb_build_object('points', points, 'givenname', given_name, 'surname', surname)) as "outcomes"
        from vw_denormalised
        where due_date_time > $1 and due_date_time < $2
        group by class_id,  assignment_id, class_display_name, display_name, due_date_time
        order by class_display_name, display_name, due_date_time desc
        )
        group by class_id,  class_display_name
       order by class_display_name;
;
                    `;t=(await d.query(a,[e,s])).rows}catch(e){console.error(e),a=e}finally{return{data:t,error:a}}},o=async()=>{let e,s=null;try{let e=`select dc.display_name, dc.teacher, ac.count 
    from dept_classes dc
    left join (
    
        SELECT c.display_name, count(*) 
        FROM assignments a
        left join classes c 
        on a.class_id = c.id
        group by c.display_name 
    
    ) ac on dc.display_name = ac.display_name
    order by dc.teacher, dc.display_name;`;s=(await d.query(e)).rows}catch(s){console.error(s),e=s}finally{return{data:s,error:e}}}},61519:(e,s,t)=>{"use strict";t.d(s,{G:()=>l,IZ:()=>d,Pv:()=>n,XW:()=>i,YL:()=>r});var a=t(71603);let l=e=>e.startOf("week").plus({week:"Sun"===e.weekdayShort?1:0}).minus({day:1}),n=e=>l(e).plus({days:7}),r=e=>{let s=a.ou.now(),t=l(e),r=n(e);return s>=t&&s<r},i=e=>{let s=l(a.ou.local()).plus({weeks:1}),t=s.plus({days:7});return e>=s&&e<t},d=e=>{a.ou.local();let s=l(e).minus({weeks:1}),t=s.plus({days:7});return e>=s&&e<t}},46804:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(19510);t(71159);var l=t(29),n=t(57371),r=t(64616);let i=({data:e,cl:s})=>a.jsx(a.Fragment,{children:a.jsx("div",{className:"flex m-1",children:a.jsx(n.default,{href:`/planning-marking/${encodeURIComponent(s)}`,children:a.jsx("div",{className:`${((e,s)=>{if(!e)return"bg-slate-300";let t=(0,r.Z)(e);return t&&0===t.length?"bg-green-700":"bg-red-700"})(e,0)} rounded-xl text-white text-xs p-1 pl-2  pr-2 w-auto border-green-400 border-solid border-4`,children:s})})})}),d=({subject:e,data:s,classes:t})=>a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"text-2xl w-1/4",children:e}),a.jsx("div",{className:"flex",children:t&&t.map((e,t)=>a.jsx(i,{cl:e,data:s?.filter(s=>s.class_display_name==e)[0]},t))})]})});var c=t(71603),o=t(35900),m=t.n(o),u=t(46812),x=t(52359),g=t(61519);let{Client:p,Pool:h}=m();new h(u.T);let _=async({children:e})=>{let s=(0,g.G)(c.ou.now()),t=s.minus({weeks:52}),n=s.plus({weeks:52}),{data:r,error:i}=await (0,x.N)(t,n);return void 0===r||i?(0,a.jsxs)("pre",{children:[JSON.stringify(r,null,2)," ",JSON.stringify(i,null,2)]}):a.jsx("div",{children:(0,a.jsxs)("div",{className:"grid grid-flow-col auto-cols-max grid-cols-12 items-start",children:[(0,a.jsxs)("div",{className:"grid col-span-6 ",children:[a.jsx(l.Z,{children:"Planning Marking"}),(0,a.jsxs)("div",{className:"grid",children:[a.jsx(d,{subject:"BS",classes:["23-13BS","23-12BS"],data:r}),a.jsx(d,{subject:"BS",classes:["23-11BS1","23-11BS2","23-10BS1","23-10BS2"],data:r}),a.jsx(d,{subject:"EC",classes:["23-11EC1","23-10EC1","23-10EC2"],data:r}),a.jsx(d,{subject:"IT",classes:["23-11IT","23-10IT"],data:r}),a.jsx(d,{subject:"CS",classes:["23-11CS","23-10CS"],data:r}),a.jsx(d,{subject:"DT",classes:["23-11DT","23-10DT"],data:r}),a.jsx(d,{subject:"9IT",classes:["23-9AIT1","23-9BIT1","23-9CIT1"],data:r}),a.jsx(d,{subject:"8IT",classes:["23-8AIT1","23-8BIT1","23-8CIT1"],data:r}),a.jsx(d,{subject:"7IT",classes:["23-7A/IT1","23-7B/It1","23-7C/It1","23-7D/It1"],data:r}),a.jsx(d,{subject:"9DT",classes:["23-9A/Dt","23-9B/Dt","23-9C/Dt"],data:r}),a.jsx(d,{subject:"8DT",classes:["23-8A-DT","23-8B-DT","23-8C-DT"],data:r}),a.jsx(d,{subject:"7DT",classes:["23-7A/Dt1","23-7B/DT1","23-7C/Dt1","23-7D/Dt1"],data:r})]})," "]}),a.jsx("div",{className:"grid col-span-6",children:a.jsx("div",{children:e})})]})})}},46812:(e,s,t)=>{"use strict";t.d(s,{T:()=>a});let a={user:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,database:process.env.POSTGRES_DB,host:process.env.POSTGRES_HOST}},29:(e,s,t)=>{"use strict";t.d(s,{Z:()=>l});var a=t(19510);t(71159);let l=({children:e})=>a.jsx("div",{className:"text-slate-600 text-5xl",children:e})},57481:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var a=t(66621);let l=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},67272:()=>{}};