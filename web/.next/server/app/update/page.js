(()=>{var e={};e.id=250,e.ids=[250],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},35900:e=>{"use strict";e.exports=require("pg")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},31155:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>b,pages:()=>o,routeModule:()=>p,tree:()=>l}),a(21266),a(35954),a(35866);var t=a(23191),n=a(88716),r=a(37922),d=a.n(r),c=a(95231),i={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>c[e]);a.d(s,i);let l=["",{children:["update",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,21266)),"/Users/leroysalih/Long-task-svr/web/app/update/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,35954)),"/Users/leroysalih/Long-task-svr/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["/Users/leroysalih/Long-task-svr/web/app/update/page.tsx"],b="/update/page",u={require:a,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/update/page",pathname:"/update",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},15550:(e,s,a)=>{let t={"037192152793ed3b7e340ccda21ed1724e7cdd94":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_3),"0a7068661e484452384eb20f440604a6316764df":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_6),"16c572eef18892eab1a5d8acc6522c239fcb10a9":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateOutcomesByClassTag),"2163d60cc403d3219f51848724786a72aba90d75":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateOutcomesByAssignmentID),"3a5b1a5d9fbb60b1992bcb8cd46480d42a3af5f5":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_1),"448558ba4655c1ce8d7db9818c076052b2b963f9":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateClasses),"47717431253219e7183eb2e0f447a263857c3bc7":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateAssignmentsByClassTag),"702e479893ff1a0030c209782e4598179af978d9":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateUsers),"73bc6cba0891d96546ed3bdb4b50773c80496346":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_5),"91432a40184c84d5e0a3ef4751054b199ebb343a":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_0),"9bca5f5b243a12749829d79daa2ff2aa2f28c9e3":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateAssignments),"9dc354239270f4d5a964c4a06edefa42082bd5fb":()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.handleUpdateOutcomes),b2101ea4f732d65420890053befe91739a824106:()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_4),db363b088250387688b1bd1a81b055fec2fe7bc8:()=>Promise.resolve().then(a.bind(a,33829)).then(e=>e.$$ACTION_2)};async function n(e,...s){return(await t[e]()).apply(null,s)}e.exports={"037192152793ed3b7e340ccda21ed1724e7cdd94":n.bind(null,"037192152793ed3b7e340ccda21ed1724e7cdd94"),"0a7068661e484452384eb20f440604a6316764df":n.bind(null,"0a7068661e484452384eb20f440604a6316764df"),"16c572eef18892eab1a5d8acc6522c239fcb10a9":n.bind(null,"16c572eef18892eab1a5d8acc6522c239fcb10a9"),"2163d60cc403d3219f51848724786a72aba90d75":n.bind(null,"2163d60cc403d3219f51848724786a72aba90d75"),"3a5b1a5d9fbb60b1992bcb8cd46480d42a3af5f5":n.bind(null,"3a5b1a5d9fbb60b1992bcb8cd46480d42a3af5f5"),"448558ba4655c1ce8d7db9818c076052b2b963f9":n.bind(null,"448558ba4655c1ce8d7db9818c076052b2b963f9"),"47717431253219e7183eb2e0f447a263857c3bc7":n.bind(null,"47717431253219e7183eb2e0f447a263857c3bc7"),"702e479893ff1a0030c209782e4598179af978d9":n.bind(null,"702e479893ff1a0030c209782e4598179af978d9"),"73bc6cba0891d96546ed3bdb4b50773c80496346":n.bind(null,"73bc6cba0891d96546ed3bdb4b50773c80496346"),"91432a40184c84d5e0a3ef4751054b199ebb343a":n.bind(null,"91432a40184c84d5e0a3ef4751054b199ebb343a"),"9bca5f5b243a12749829d79daa2ff2aa2f28c9e3":n.bind(null,"9bca5f5b243a12749829d79daa2ff2aa2f28c9e3"),"9dc354239270f4d5a964c4a06edefa42082bd5fb":n.bind(null,"9dc354239270f4d5a964c4a06edefa42082bd5fb"),b2101ea4f732d65420890053befe91739a824106:n.bind(null,"b2101ea4f732d65420890053befe91739a824106"),db363b088250387688b1bd1a81b055fec2fe7bc8:n.bind(null,"db363b088250387688b1bd1a81b055fec2fe7bc8")}},1693:(e,s,a)=>{Promise.resolve().then(a.bind(a,6136)),Promise.resolve().then(a.t.bind(a,79404,23))},52372:(e,s,a)=>{Promise.resolve().then(a.t.bind(a,12994,23)),Promise.resolve().then(a.t.bind(a,96114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,79671,23)),Promise.resolve().then(a.t.bind(a,41868,23)),Promise.resolve().then(a.t.bind(a,84759,23))},35303:()=>{},6136:(e,s,a)=>{"use strict";a.d(s,{default:()=>r});var t=a(10326),n=a(17577);let r=()=>{let[e,s]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=new EventSource("/api/sse");return e.onmessage=e=>{let a=JSON.parse(e.data);s(e=>[a,...e])},e.onerror=s=>{console.error("EventSource failed:",s),e.close()},()=>{e.close()}},[]),(0,t.jsxs)("div",{children:[t.jsx("h1",{children:"Server-Sent Events"}),t.jsx("ul",{children:e&&e.length>0&&e[0].message})]})}},94012:(e,s,a)=>{"use strict";a.d(s,{L:()=>t});let t={providers:[(0,a(27606).Z)({clientId:process.env.AZURE_AD_CLIENT_ID,clientSecret:process.env.AZURE_AD_CLIENT_SECRET,tenantId:process.env.AZURE_AD_TENANT_ID,authorization:{params:{scope:"openid profile user.Read email"}}})],secret:process.env.NEXTAUTH_SECRET,callbacks:{jwt:async({token:e,account:s})=>(s&&(e.idToken=s.id_token,e.accessToken=s.access_token),e),session:async({session:e,token:s})=>(e.accessToken=s.accessToken,e.idToken=s.idToken,e)}}},35954:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m,metadata:()=>p});var t=a(19510),n=a(85384),r=a.n(n);a(67272);var d=a(57371);let c=()=>{let e=[{label:"Home",url:"/"},{label:"Update",url:"/update"},{label:"P&M",url:"/planning-marking"}];return t.jsx(t.Fragment,{children:e&&e.map((e,s)=>t.jsx(d.default,{className:"p-3 rounded-md ",href:e.url,children:t.jsx("div",{children:e.label})},s))})};var i=a(68570);let l=(0,i.createProxy)(String.raw`/Users/leroysalih/Long-task-svr/web/components/log-listener/index.tsx`),{__esModule:o,$$typeof:b}=l;l.default;let u=(0,i.createProxy)(String.raw`/Users/leroysalih/Long-task-svr/web/components/log-listener/index.tsx#default`);console.log("Database HOST",process.env.POSTGRES_HOST),console.log("Message HOST",process.env.RABBITMQ_DEFAULT_HOST);let p={title:"CAT Dept",description:"Created by Leroy Salih"};function m({children:e}){return t.jsx("html",{lang:"en",children:(0,t.jsxs)("body",{className:`${r().className} text-grey-600 bg-slate-100`,children:[t.jsx("div",{className:"min-h-[100px] text-skin-inverted text-4xl flex items-center pl-5 bg-slate-700 text-white font-roboto-condensed ",children:"Commerce and Technology Dept"}),(0,t.jsxs)("div",{className:"flex flex-col place-content-center w-100 grid-cols-1 gap-4 md:grid md:grid-cols-12",children:[(0,t.jsxs)("div",{className:"min-h-[100px] rounded-lg bg-slate-300 shadow  m-2 p-4 md:block md:col-span-2 ",children:[t.jsx(c,{}),t.jsx(u,{})]}),t.jsx("div",{className:"min-h-[100px] rounded-lg bg-white shadow text-slate-700 m-2  md:col-span-10 truncate ",children:t.jsx("div",{className:"m-4 p-4",children:e})})]})]})})}},52359:(e,s,a)=>{"use strict";a.d(s,{N:()=>l,n:()=>o});var t=a(35900),n=a.n(t),r=a(46812);let{Client:d,Pool:c}=n(),i=new c(r.T),l=async(e,s)=>{let a,t;try{let t=`select class_id, class_display_name, jsonb_agg( json_build_object( 'assignment', assignment, 'outcomes', outcomes )) as assignments
        from (
        select class_id,  class_display_name, 
                json_build_object('assignment_id', assignment_id, 'display_name', display_name, 'due_date_time', due_date_time) as "assignment", 
                json_agg( jsonb_build_object('points', points, 'givenname', given_name, 'surname', surname)) as "outcomes"
        from vw_denormalised
        where due_date_time > $1 and due_date_time < $2
        group by class_id,  assignment_id, class_display_name, display_name, due_date_time
        order by class_display_name, display_name, due_date_time desc
        )
        group by class_id,  class_display_name
       order by class_display_name;
;
                    `;a=(await i.query(t,[e,s])).rows}catch(e){console.error(e),t=e}finally{return{data:a,error:t}}},o=async()=>{let e,s=null;try{let e=`select dc.display_name, dc.teacher, ac.count 
    from dept_classes dc
    left join (
    
        SELECT c.display_name, count(*) 
        FROM assignments a
        left join classes c 
        on a.class_id = c.id
        group by c.display_name 
    
    ) ac on dc.display_name = ac.display_name
    order by dc.teacher, dc.display_name;`;s=(await i.query(e)).rows}catch(s){console.error(s),e=s}finally{return{data:s,error:e}}}},33829:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$ACTION_0:()=>o,$$ACTION_1:()=>u,$$ACTION_2:()=>m,$$ACTION_3:()=>h,$$ACTION_4:()=>x,$$ACTION_5:()=>v,$$ACTION_6:()=>T,handleUpdateAssignments:()=>p,handleUpdateAssignmentsByClassTag:()=>f,handleUpdateClasses:()=>l,handleUpdateOutcomes:()=>y,handleUpdateOutcomesByAssignmentID:()=>g,handleUpdateOutcomesByClassTag:()=>_,handleUpdateUsers:()=>b});var t=a(24330);a(60166);var n=a(62368),r=a(45609),d=a(94012),c=a(40618);let i=async(e,s,a=null)=>{let t,r=null;try{if(!e||!s)throw Error("No token passed");n.connect("amqp://user:password@message",function(n,r){if(n)throw n;r.createChannel(function(n,r){if(n)throw n;var d="task_queue",c=JSON.stringify({task:e,payload:a,token:s});r.assertQueue(d,{durable:!0}),r.sendToQueue(d,Buffer.from(c)),console.info(" [x] Sent %s",c),t={status:"ok"}})})}catch(s){console.error("[ERROR!] postMessageToQueue",e,s.message),r=s}finally{return{data:t,error:r}}},l=(0,t.j)("91432a40184c84d5e0a3ef4751054b199ebb343a",o);async function o(){console.info("Updating Classes");let e=await (0,r.getServerSession)(d.L);i("update-classes",e?.accessToken)}let b=(0,t.j)("3a5b1a5d9fbb60b1992bcb8cd46480d42a3af5f5",u);async function u(){let e=await (0,r.getServerSession)(d.L);i("update-users",e?.accessToken)}let p=(0,t.j)("db363b088250387688b1bd1a81b055fec2fe7bc8",m);async function m(){let e=await (0,r.getServerSession)(d.L);i("update-assignments",e?.accessToken)}let f=(0,t.j)("037192152793ed3b7e340ccda21ed1724e7cdd94",h);async function h(e){let s=await (0,r.getServerSession)(d.L);i("update-assignments-class-tag",s?.accessToken,{classTag:e.get("classTag")})}let g=(0,t.j)("b2101ea4f732d65420890053befe91739a824106",x);async function x(e){let s=await (0,r.getServerSession)(d.L);i("update-outcomes-assignment-id",s?.accessToken,{assignment_id:e.get("assignment_id")})}let _=(0,t.j)("73bc6cba0891d96546ed3bdb4b50773c80496346",v);async function v(e){let s=await (0,r.getServerSession)(d.L);i("update-outcomes-class-tag",s?.accessToken,{classTag:e.get("classTag")})}let y=(0,t.j)("0a7068661e484452384eb20f440604a6316764df",T);async function T(){let e=await (0,r.getServerSession)(d.L);i("update-outcomes",e?.accessToken)}(0,c.h)([l,b,p,f,g,_,y]),(0,t.j)("448558ba4655c1ce8d7db9818c076052b2b963f9",l),(0,t.j)("702e479893ff1a0030c209782e4598179af978d9",b),(0,t.j)("9bca5f5b243a12749829d79daa2ff2aa2f28c9e3",p),(0,t.j)("47717431253219e7183eb2e0f447a263857c3bc7",f),(0,t.j)("2163d60cc403d3219f51848724786a72aba90d75",g),(0,t.j)("16c572eef18892eab1a5d8acc6522c239fcb10a9",_),(0,t.j)("9dc354239270f4d5a964c4a06edefa42082bd5fb",y)},21266:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>c});var t=a(19510),n=a(29),r=a(33829),d=a(52359);let c=async()=>{let{data:e,error:s}=await (0,d.n)();return s?t.jsx("h1",{children:s.message}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(n.Z,{children:"Update"}),t.jsx("form",{action:r.handleUpdateClasses,children:t.jsx("button",{type:"submit",children:"Update Classes"})}),t.jsx("form",{action:r.handleUpdateUsers,children:t.jsx("button",{type:"submit",children:"Update Users"})}),t.jsx("form",{action:r.handleUpdateAssignments,children:t.jsx("button",{type:"submit",children:"Update Assignments"})}),t.jsx("form",{action:r.handleUpdateOutcomes,children:t.jsx("button",{type:"submit",children:"Update Marking"})}),t.jsx("h1",{children:"Assignment Counts"}),e?.map((e,s)=>t.jsxs("div",{className:"flex grid grid-cols-3",children:[t.jsx("div",{className:"m-2",children:e.teacher}),t.jsx("div",{className:"m-2",children:e.display_name}),t.jsx("div",{className:"m-2",children:e.count})]},s))]})}},46812:(e,s,a)=>{"use strict";a.d(s,{T:()=>t});let t={user:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,database:process.env.POSTGRES_DB,host:process.env.POSTGRES_HOST}},29:(e,s,a)=>{"use strict";a.d(s,{Z:()=>n});var t=a(19510);a(71159);let n=({children:e})=>t.jsx("div",{className:"text-slate-600 text-5xl",children:e})},57481:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>n});var t=a(66621);let n=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,t.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},67272:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[948,836,729,621,92,775,595],()=>a(31155));module.exports=t})();