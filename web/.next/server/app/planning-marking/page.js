(()=>{var e={};e.id=23,e.ids=[23],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},35900:e=>{"use strict";e.exports=require("pg")},71017:e=>{"use strict";e.exports=require("path")},57310:e=>{"use strict";e.exports=require("url")},24405:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>o}),t(78971),t(46804),t(35954),t(35866);var a=t(23191),r=t(88716),n=t(37922),l=t.n(n),i=t(95231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);t.d(s,c);let o=["",{children:["planning-marking",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,78971)),"/Users/leroysalih/Long-task-svr-001/web/app/planning-marking/page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,46804)),"/Users/leroysalih/Long-task-svr-001/web/app/planning-marking/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,35954)),"/Users/leroysalih/Long-task-svr-001/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/leroysalih/Long-task-svr-001/web/app/planning-marking/page.tsx"],u="/planning-marking/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/planning-marking/page",pathname:"/planning-marking",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},14721:(e,s,t)=>{let a={"17c6ca8b2647c6e6f3dc92e6fc6c84483b08a5df":()=>Promise.resolve().then(t.bind(t,3041)).then(e=>e.checkLog),"499733668ee50ed6650f64c7120bfaf6eea5e4e5":()=>Promise.resolve().then(t.bind(t,3041)).then(e=>e.$$ACTION_0),a6d76c2fc7e0c8acf7a6ebe9546599362f66a009:()=>Promise.resolve().then(t.bind(t,3041)).then(e=>e.log),b5c1eb8038f30cd5a72b73f856f5c28e40129f90:()=>Promise.resolve().then(t.bind(t,3041)).then(e=>e.$$ACTION_1)};async function r(e,...s){return(await a[e]()).apply(null,s)}e.exports={"17c6ca8b2647c6e6f3dc92e6fc6c84483b08a5df":r.bind(null,"17c6ca8b2647c6e6f3dc92e6fc6c84483b08a5df"),"499733668ee50ed6650f64c7120bfaf6eea5e4e5":r.bind(null,"499733668ee50ed6650f64c7120bfaf6eea5e4e5"),a6d76c2fc7e0c8acf7a6ebe9546599362f66a009:r.bind(null,"a6d76c2fc7e0c8acf7a6ebe9546599362f66a009"),b5c1eb8038f30cd5a72b73f856f5c28e40129f90:r.bind(null,"b5c1eb8038f30cd5a72b73f856f5c28e40129f90")}},42623:(e,s,t)=>{Promise.resolve().then(t.bind(t,58622)),Promise.resolve().then(t.t.bind(t,79404,23))},50276:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},34312:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,79404,23))},35303:()=>{},58622:(e,s,t)=>{"use strict";t.d(s,{default:()=>c});var a=t(10326),r=t(17577);t(15424);var n=t(46242),l=(0,n.$)("17c6ca8b2647c6e6f3dc92e6fc6c84483b08a5df");(0,n.$)("a6d76c2fc7e0c8acf7a6ebe9546599362f66a009");var i=t(68749);let c=()=>{let[e,s]=(0,r.useState)(void 0),[t,n]=(0,r.useState)(i.ou.now().toISO()),[c,o]=(0,r.useState)(null),d=async()=>{let{data:e,error:t}=await l(i.ou.now().minus({days:1}).toISO());if(t||!e){o(t),n(e?e?.created_at:null);return}console.log(e),s(e?.logs),n(e?.created_at)};return(0,r.useEffect)(()=>{let e=setInterval(d,1e3);return()=>{clearInterval(e)}},[]),(0,a.jsxs)("div",{children:[a.jsx("div",{children:"Logs"}),a.jsx("div",{className:"text-xs",children:t}),(0,a.jsxs)("ul",{children:[a.jsx("div",{children:e&&e.length>0&&e[0].msg}),a.jsx("div",{children:e&&e.length>0&&e[0].created_at&&i.ou.fromISO(e[0].created_at).toISO()?.substring(0,10)})]})]})}},35954:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g,metadata:()=>p});var a=t(19510),r=t(85384),n=t.n(r);t(67272);var l=t(57371);let i=()=>{let e=[{label:"Home",url:"/"},{label:"Update",url:"/update"},{label:"P&M",url:"/planning-marking"}];return a.jsx(a.Fragment,{children:e&&e.map((e,s)=>a.jsx(l.default,{className:"p-3 rounded-md ",href:e.url,children:a.jsx("div",{children:e.label})},s))})};var c=t(68570);let o=(0,c.createProxy)(String.raw`/Users/leroysalih/Long-task-svr-001/web/components/log-listener/index.tsx`),{__esModule:d,$$typeof:u}=o;o.default;let m=(0,c.createProxy)(String.raw`/Users/leroysalih/Long-task-svr-001/web/components/log-listener/index.tsx#default`);console.log("Database HOST",process.env.POSTGRES_HOST),console.log("Message HOST",process.env.RABBITMQ_DEFAULT_HOST);let p={title:"CAT Dept",description:"Created by Leroy Salih"};function g({children:e}){return a.jsx("html",{lang:"en",children:(0,a.jsxs)("body",{className:`${n().className} text-grey-600 bg-slate-100`,children:[a.jsx("div",{className:"min-h-[100px] text-skin-inverted text-4xl flex items-center pl-5 bg-slate-700 text-white font-roboto-condensed ",children:"CaT Dept \uD83D\uDE38"}),(0,a.jsxs)("div",{className:"flex flex-col place-content-center w-100 grid-cols-1 gap-4 md:grid md:grid-cols-12",children:[(0,a.jsxs)("div",{className:"min-h-[100px] rounded-lg bg-slate-300 shadow  m-2 p-4 md:block md:col-span-2 ",children:[a.jsx(i,{}),a.jsx(m,{})]}),a.jsx("div",{className:"min-h-[100px] rounded-lg bg-white shadow text-slate-700 m-2  md:col-span-10 truncate ",children:a.jsx("div",{className:"m-4 p-4",children:e})})]})]})})}},64616:(e,s,t)=>{"use strict";t.d(s,{Z:()=>c});var a=t(71603),r=t(61519);let n=e=>{let s=a.ou.fromISO(e);return(0,r.YL)(s)},l=e=>{let s=a.ou.fromISO(e);return(0,r.XW)(s)},i=e=>{let s=a.ou.fromISO(e);return(0,r.IZ)(s)},c=e=>{if(void 0===e||void 0===e.assignments)return["noClassPlanningData"];let{assignments:s}=e,t=[],a=s.filter(e=>n(e.assignment.due_date_time))||[];0==a.length&&t.push("hasNoAssignmentsInCurrentWeek"),(s.filter(e=>l(e.assignment.due_date_time))||[]).length;let r=!1;if((s.filter(e=>i(e.assignment.due_date_time))||[]).length>0){for(let e of a)if(e.outcomes.filter(e=>null===e.points).length>0){r=!0;break}r&&t.push("hasUnmarkedInPrevWeek")}return t}},52359:(e,s,t)=>{"use strict";t.d(s,{N:()=>o,n:()=>d});var a=t(35900),r=t.n(a),n=t(46812);let{Client:l,Pool:i}=r(),c=new i(n.T),o=async(e,s)=>{let t,a;try{let a=`select class_id, class_display_name, jsonb_agg( json_build_object( 'assignment', assignment, 'outcomes', outcomes )) as assignments
        from (
        select class_id,  class_display_name, 
                json_build_object('assignment_id', assignment_id, 'display_name', display_name, 'due_date_time', due_date_time) as "assignment", 
                json_agg( jsonb_build_object('points', points, 'givenname', given_name, 'surname', surname)) as "outcomes"
        from vw_denormalised
        where due_date_time > $1 and due_date_time < $2
        group by class_id,  assignment_id, class_display_name, display_name, due_date_time
        order by class_display_name, display_name, due_date_time desc
        )
        group by class_id,  class_display_name
       order by class_display_name;
;
                    `;t=(await c.query(a,[e,s])).rows}catch(e){console.error(e),a=e}finally{return{data:t,error:a}}},d=async()=>{let e,s=null;try{let e=`select dc.display_name, dc.teacher, ac.count 
    from dept_classes dc
    left join (
    
        SELECT c.display_name, count(*) 
        FROM assignments a
        left join classes c 
        on a.class_id = c.id
        group by c.display_name 
    
    ) ac on dc.display_name = ac.display_name
    order by dc.teacher, dc.display_name;`;s=(await c.query(e)).rows}catch(s){console.error(s),e=s}finally{return{data:s,error:e}}}},61519:(e,s,t)=>{"use strict";t.d(s,{G:()=>r,IZ:()=>c,Pv:()=>n,XW:()=>i,YL:()=>l});var a=t(71603);let r=e=>e.startOf("week").plus({week:"Sun"===e.weekdayShort?1:0}).minus({day:1}),n=e=>r(e).plus({days:7}),l=e=>{let s=a.ou.now(),t=r(e),l=n(e);return s>=t&&s<l},i=e=>{let s=r(a.ou.local()).plus({weeks:1}),t=s.plus({days:7});return e>=s&&e<t},c=e=>{a.ou.local();let s=r(e).minus({weeks:1}),t=s.plus({days:7});return e>=s&&e<t}},46804:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var a=t(19510);t(71159);var r=t(29),n=t(57371),l=t(64616);let i=({data:e,cl:s})=>a.jsx(a.Fragment,{children:a.jsx("div",{className:"flex m-1",children:a.jsx(n.default,{href:`/planning-marking/${encodeURIComponent(s)}`,children:a.jsx("div",{className:`${((e,s)=>{if(!e)return"bg-slate-300";let t=(0,l.Z)(e);return t&&0===t.length?"bg-green-700":"bg-red-700"})(e,0)} rounded-xl text-white text-xs p-1 pl-2  pr-2 w-auto border-green-400 border-solid border-4`,children:s})})})}),c=({subject:e,data:s,classes:t})=>a.jsx(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"text-2xl w-1/4",children:e}),a.jsx("div",{className:"flex",children:t&&t.map((e,t)=>a.jsx(i,{cl:e,data:s?.filter(s=>s.class_display_name==e)[0]},t))})]})});var o=t(71603),d=t(35900),u=t.n(d),m=t(46812),p=t(52359),g=t(61519);let{Client:f,Pool:x}=u();new x(m.T);let b=async({children:e})=>{let s=(0,g.G)(o.ou.now()),t=s.minus({weeks:52}),n=s.plus({weeks:52}),{data:l,error:i}=await (0,p.N)(t,n);return void 0===l||i?(0,a.jsxs)("pre",{children:[JSON.stringify(l,null,2)," ",JSON.stringify(i,null,2)]}):a.jsx("div",{children:(0,a.jsxs)("div",{className:"grid grid-flow-col auto-cols-max grid-cols-12 items-start",children:[(0,a.jsxs)("div",{className:"grid col-span-6 ",children:[a.jsx(r.Z,{children:"Planning Marking"}),(0,a.jsxs)("div",{className:"grid",children:[a.jsx(c,{subject:"BS",classes:["23-13BS","23-12BS"],data:l}),a.jsx(c,{subject:"BS",classes:["23-11BS1","23-11BS2","23-10BS1","23-10BS2"],data:l}),a.jsx(c,{subject:"EC",classes:["23-11EC1","23-10EC1","23-10EC2"],data:l}),a.jsx(c,{subject:"IT",classes:["23-11IT","23-10IT"],data:l}),a.jsx(c,{subject:"CS",classes:["23-11CS","23-10CS"],data:l}),a.jsx(c,{subject:"DT",classes:["23-11DT","23-10DT"],data:l}),a.jsx(c,{subject:"9IT",classes:["23-9AIT1","23-9BIT1","23-9CIT1"],data:l}),a.jsx(c,{subject:"8IT",classes:["23-8AIT1","23-8BIT1","23-8CIT1"],data:l}),a.jsx(c,{subject:"7IT",classes:["23-7A/IT1","23-7B/It1","23-7C/It1","23-7D/It1"],data:l}),a.jsx(c,{subject:"9DT",classes:["23-9A/Dt","23-9B/Dt","23-9C/Dt"],data:l}),a.jsx(c,{subject:"8DT",classes:["23-8A-DT","23-8B-DT","23-8C-DT"],data:l}),a.jsx(c,{subject:"7DT",classes:["23-7A/Dt1","23-7B/DT1","23-7C/Dt1","23-7D/Dt1"],data:l})]})," "]}),a.jsx("div",{className:"grid col-span-6",children:a.jsx("div",{children:e})})]})})}},78971:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l,dynamic:()=>n});var a=t(19510),r=t(29);let n="force-dynamic",l=async()=>a.jsx(a.Fragment,{children:a.jsx(r.Z,{children:"Summary Page"})})},5709:(e,s,t)=>{"use strict";t.d(s,{dbConnection:()=>a});let a={user:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,database:process.env.POSTGRES_DB,host:process.env.POSTGRES_HOST}},46812:(e,s,t)=>{"use strict";t.d(s,{T:()=>a});let a={user:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,database:process.env.POSTGRES_DB,host:process.env.POSTGRES_HOST}},29:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});var a=t(19510);t(71159);let r=({children:e})=>a.jsx("div",{className:"text-slate-600 text-5xl",children:e})},3041:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$ACTION_0:()=>p,$$ACTION_1:()=>f,checkLog:()=>g,log:()=>m});var a=t(27745);t(26461);var r=t(35900),n=t.n(r),l=t(5709),i=t(82872),c=t(85723);let{Client:o,Pool:d}=n(),u=new d(l.dbConnection),m=(0,a.registerServerReference)("499733668ee50ed6650f64c7120bfaf6eea5e4e5",p);async function p(e,s,t){let a=null,r="";try{let r=await u.query("insert into logs (app, status, msg) values ($1, $2, $3)",[e,s,t]);a={created_at:i.DateTime.now().toISO(),logs:r.rows}}catch(e){a=null,e instanceof Error&&(r=e.message,console.log(e.message))}finally{return{data:a,error:r}}}let g=(0,a.registerServerReference)("b5c1eb8038f30cd5a72b73f856f5c28e40129f90",f);async function f(e){let s=i.DateTime.fromISO(e),t=null,a=null;try{let e=`SELECT created_at, app, status, msg 
                   FROM logs
                   WHERE created_at >= $1
                   ORDER BY created_at desc
                   LIMIT 1
                   `,a=await u.query(e,[s.toISO()]);if(!a||!a.rows)throw Error("no rows returned");t={created_at:i.DateTime.now().toISO(),logs:a.rows}}catch(e){(e="")instanceof Error&&(a=e.message)}finally{return{data:t,error:a}}}(0,c.ensureServerEntryExports)([m,g]),(0,a.registerServerReference)("a6d76c2fc7e0c8acf7a6ebe9546599362f66a009",m),(0,a.registerServerReference)("17c6ca8b2647c6e6f3dc92e6fc6c84483b08a5df",g)},57481:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(66621);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},67272:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[948,111,621,827,603],()=>t(24405));module.exports=a})();